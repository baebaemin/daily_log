## Today I Learned

### [React] useState ëŒ€ì‹  useRefë¡œ ê´€ë¦¬í•˜ì—¬ ë¦¬ë Œë”ë§ ê°ì†Œì‹œí‚¤ê¸°

- ìƒí™©: ì¹¸ë°˜ ë³´ë“œì˜ Drag & Drop ê¸°ëŠ¥ êµ¬í˜„ ì¤‘ destinationì— ëŒ€í•­í•˜ëŠ” DOM ê°ì²´ë¥¼ stateë¡œ ê´€ë¦¬í•˜ê³  ìˆì—ˆë‹¤. ê·¸ë¦¬ê³  destinationì´ ë°”ë€” ë•Œë§ˆë‹¤ useEffectë¡œ í•´ë‹¹ DOMì— classList ë° style ì†ì„±ì„ ë³€ê²½í–ˆë‹¤. ë“œë˜ê·¸ ê¸°ëŠ¥ì´ ì¢…ë£Œë  ë•Œ í•´ë‹¹ ì†ì„±ë“¤ì„ ì›ë³µí•˜ê¸° ìœ„í•´ useEffectë¡œ í´ë¦°ì—…ì„ ì§„í–‰í•œë‹¤.

```tsx
// ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” drag í•¸ë“¤ëŸ¬ì˜ ì´ë²¤íŠ¸ ê°ì²´ íƒ€ì…
import { DragDropContext, DragStart, DragUpdate, DropResult } from "@hello-pangea/dnd";

const draggableItemAttr = "data-rfd-draggable-id"; // ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë¶€ì—¬í•˜ëŠ” draggableItem id
const [destination, setDestination] = useState<HTMLElement | null>(null);

/** drag ì‹œì‘ event í•¸ë“¤ëŸ¬ */
const handleDragStart = (event: DragStart) => {
  const domQuery = `[${draggableItemAttr}='${event.draggableId}']`;
  const draggedDom = document.querySelector(domQuery); // ë“œë˜ê·¸ì¤‘ì¸ dom í• ë‹¹
  setCardHeight(draggedDom?.clientHeight || 0); // ì œê°ê° ë‹¤ë¥¸ ì¹´ë“œì˜ ë†’ì´ì™€ placeholderì˜ ë†’ì´ë¥¼ ë™ì¼í•˜ê²Œ ì„¸íŒ…í•˜ê¸° ìœ„í•´ Heightë¥¼ êµ¬í•œë‹¤
};

/** dragê°€ dropë  ìœ„ì¹˜(id) ë³€ê²½ event í•¸ë“¤ëŸ¬ */
const handleDragUpdate = (event: DragUpdate) => {
  const { destination } = event;

  const domQuery = `[${draggableItemAttr}="draggable-${destination?.index}"]`;
  const destinationDom = document.querySelector(domQuery) as HTMLElement; // positionì´ ë™ì ìœ¼ë¡œ ë°”ë€Œë©´ì„œ Placeholder ê³µê°„ì„ ë§Œë“¤ì–´ì£¼ëŠ” card dom í• ë‹¹

  // ìœ íš¨í•œ destinationìœ¼ë¡œë¶€í„° ë²—ì–´ë‚¬ì„ ë•Œ placeholder í´ë¦°ì—…
  if (!destination) return destinationRef.current?.classList.remove(cx("placeholder"));

  if (destinationDom) {
    // destination ë³€ê²½ì‹œ ì´ì „ destinationDomì˜ placeholder í´ë¦°ì—…
    destinationRef.current?.classList.remove(cx("placeholder"));

    // NOTE: -7ê³¼ 3ì€ react-beautiful-dndì—ì„œ ê³„ì‚°í•œ ë†’ì´, ìœ„ì¹˜ ê°’ì„ KanbanCard gapì— ë§ì¶° ì¡°ì •í•˜ê¸° ìœ„í•œ ìˆ«ì
    destinationDom.style.setProperty("--placeholder-height", `${cardHeight - 7}px`);
    destinationDom.style.setProperty("--placeholder-top", `-${cardHeight + 3}px`);
    destinationDom.classList.add(cx("placeholder"));
  }

  destinationRef.current = destinationDom;

  // droppable columnì˜ ê°€ì¥ í•˜ë‹¨ destinationìœ¼ë¡œ dragí–ˆì„ ë•Œ
  if (!destinationRef.current) {
    const lastDomQuery = `[${draggableItemAttr}="draggable-${destination.index - 1}"]`;
    const lastDom = document.querySelector(lastDomQuery);
    lastDom?.classList.remove(cx("placeholder"));
  }
};

/** drag ì¢…ë£Œ event í•¸ë“¤ëŸ¬ */
const handleDragEnd = (result: DropResult) => {
  if (result.destination) {
    console.log("ë“œë˜ê·¸ ì™„ë£Œ: ", result);
  }
  // í´ë¦°ì—…
  destinationRef.current?.classList.remove(cx("placeholder"));
  destinationRef.current = null;
  setCardHeight(0);
};

return (
  <DragDropContext
    onDragStart={handleDragStart}
    onDragEnd={handleDragEnd}
    onDragUpdate={handleDragUpdate}
  >
    {TEMP_PROCESS_LIST.map((process, idx) => (
      <KanbanColumn key={`column-${process.id}`} columnId={process.id} {...process} />
    ))}
  </DragDropContext>
);
```

- íš¨ê³¼ :

  - ë¦¬ë Œë”ë§ ê°ì†Œ
  - useEffectì— ì˜ì¡´í•˜ì§€ ì•Šê³  ëª¨ë“  ë™ì‘ì´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì´ë£¨ì–´ì§€ë¯€ë¡œ, cleanup ë° DOM ìˆ˜ì • ë¡œì§ì´ ì–´ë–¤ ì‹œì ì— ì‹¤í–‰ë˜ëŠ”ì§€ ëª…í™•íˆ ì¶”ì í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

- Reactì—ì„œ DOM ê°ì²´ë¥¼ ë‹¤ë£° ë•Œ state ëŒ€ì‹  refë¥¼ ì“°ë„ë¡ í•˜ì ğŸ‘€
