## Today I Learned

### [TIL-WORDS]

- `derived`: íŒŒìƒëœ (ex. derived state)
- `effectively`: íš¨ê³¼ì ìœ¼ë¡œ, ì‹¤ì œë¡œ(= really)
- `pitfall`: í•¨ì •

## <br />

### [Debug] hydration mismatch (React Error #418)

- local ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë°œìƒí•˜ì§€ ì•Šì•˜ë˜ ì—ëŸ¬ê°€ dev, stg ë“± prod í™˜ê²½ì— ë°°í¬ëœ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ë‹¤ë³´ë‹ˆ ë°œìƒí•˜ê³  ìˆì—ˆë‹¤.
- date-fnsë¥¼ í™œìš©í•´ Date ë°ì´í„°ë¥¼ ê°€ê³µí•˜ëŠ” ë¡œì§ì´ ìˆëŠ” í˜ì´ì§€ì—ì„œ ë°œìƒí•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì •
- ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì˜ locale ì„¤ì •ì´ ë‹¤ë¥´ê³ (ì„œë²„ëŠ” ì£¼ë¡œ en-US, í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ì ë¸Œë¼ìš°ì € ì–¸ì–´ë¥¼ ë”°ë¼ê°), time zoneë„ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—(ì„œë²„ëŠ” UTC ë˜ëŠ” ì„œë²„ ìœ„ì¹˜, í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ìì˜ ë¡œì»¬ time zoneì„ ë”°ë¼ê°) ë°œìƒ

  ```js
  // ì„œë²„ì—ì„œ ë Œë”ë§: "11/12/2025, 10:00:00 AM"
  // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë Œë”ë§: "2025. 12. 11. ì˜¤ì „ 10:00:00"
  // â†’ HTML ë¶ˆì¼ì¹˜ë¡œ hydration error ë°œìƒ
  ```

- ì²« ë²ˆì§¸ ì‹œë„ : "use client"ë¥¼ hydration errorê°€ ë°œìƒí• ë§Œí•œ ìì‹ ì»´í¬ë„ŒíŠ¸ë“¤ì— ë¶™ì´ê¸° -> ì‹¤íŒ¨ ...
- ë‘ ë²ˆì§¸ ì‹œë„ : ë‚ ì§œ ê´€ë ¨ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” tagì— suppressHydrationWarning ë¶™ì´ê¸° -> ì‹¤íŒ¨ ... 2
- ì„¸ ë²ˆì§¸ ì‹œë„ : google chrome devtools mcp ì„œë²„ ì—°ê²°í•´ì„œ ì›ì¸ íŒŒì•… ìš”ì²­ ^ã…¡^ -> ... ì„±ê³µ

```tsx
// ë¬¸ì œê°€ ëë˜ í•¨ìˆ˜ - date fnsì˜ ë©”ì„œë“œë“¤ì„ ì‚¬ìš© ì¤‘
/**
 * D-day ê³„ì‚° (ë§ˆê°ì¼ ê¸°ì¤€)
 * @param recEndDtm ë§ˆê°ì¼ ë¬¸ìì—´ (ì˜ˆ: "2025-12-04T19:18:44")
 * @param maxDays ì„ê³„ê°’ (ì˜ˆ: maxDaysê°€ 3ì¼ ê²½ìš° D-4ë¶€í„°ëŠ” null ë°˜í™˜)
 * @returns D-day ë¬¸ìì—´ (ì˜ˆ: "D-3", "D-0") ë˜ëŠ” ë§ˆê°ëœ ê²½ìš° null
 */
export const getDday = ({
  endDate,
  maxDays = Infinity,
}: {
  endDate: string;
  maxDays: number;
}): string | null => {
  const now = TZDate.tz("Asia/Seoul");
  const targetDate = TZDate.tz("Asia/Seoul", endDate);

  // ë‚ ì§œë§Œ ë¹„êµí•˜ê¸° ìœ„í•´ ìì •ìœ¼ë¡œ ì •ê·œí™”
  const nowStartOfDay = startOfDay(now);
  const targetStartOfDay = startOfDay(targetDate);
  const diff = differenceInDays(targetStartOfDay, nowStartOfDay);

  // ë§ˆê°ì¼ì´ ì§€ë‚¬ê±°ë‚˜ ì„ê³„ê°’ ì´ìƒì´ë©´ null ë°˜í™˜
  if (diff <= 0 || diff > maxDays) {
    return null;
  }

  return `D-${diff === 0 ? "day" : diff}`;
};
```

```tsx
// ë¬¸ì œê°€ ëë˜ ë¶€ë¶„
const dDay = getDday({ endDate: recEndDtm, maxDays: 3 });

return (
  <span>
    {REC_ST_CD_TYPE[recStCd]} {dDay && `(${dDay})`}
  </span>
);
```

```tsx
// í•´ê²° ë°©ë²•
// í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ D-day ê³„ì‚° (hydration mismatch ë°©ì§€)
const [dDay, setDDay] = useState<string | null>(null);

useEffect(() => {
  setDDay(getDday({ endDate: recEndDtm, maxDays: 3 }));
}, [recEndDtm]);
```

- ê·¸ëŸ°ë°... useEffectì˜ ë‚¨ìš©ì€ ì•„ë‹ˆì—ˆì„ê¹Œ ğŸ¤” ë” ì¢‹ì€ ë°©ë²•ì´ ì—†ì„ì§€ ê³ ë¯¼í•´ë´ì•¼í•œë‹¤

- ê´€ë ¨ ë§í¬ : https://react.dev/reference/react-dom/client/hydrateRoot#suppressing-unavoidable-hydration-mismatch-errors
