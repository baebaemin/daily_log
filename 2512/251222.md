## Today I Learned

### [Next.js] 클라이언트에서 쿠키를 다루는 방식

- 클라이언트 사이드
    ```js
    // 브라우저 환경

    // 쿠키 이름 (필수): token
    // 쿠키값 (필수): abc123
    // 쿠키가 유효한 경로 (optional): "/admin" = /admin 경로에서만 접근 가능
    document.cookie = "token=abc123; path=/admin"
    ```

- 주요 옵션들
    ```js
    // 1. 기본 설정
    document.cookie = "username=john";

    // 2. 만료 시간 설정 (초 단위)
    document.cookie = "token=abc123; max-age=3600"; // 1시간 후 만료

    // 3. 특정 날짜에 만료
    document.cookie = "token=abc123; expires=Fri, 31 Dec 2025 23:59:59 GMT";

    // 4. 경로 지정
    document.cookie = "token=abc123; path=/dashboard"; // /dashboard에서만 유효

    // 5. 도메인 지정
    document.cookie = "token=abc123; domain=.example.com"; // 서브도메인 포함

    // 6. 보안 옵션
    document.cookie = "token=abc123; secure"; // HTTPS에서만 전송
    document.cookie = "token=abc123; httponly"; // JavaScript 접근 불가 (서버에서만 설정 가능)

    // 7. SameSite (CSRF 방지)
    document.cookie = "token=abc123; samesite=strict"; // 같은 사이트에서만
    document.cookie = "token=abc123; samesite=lax";    // 일부 크로스 사이트 허용
    document.cookie = "token=abc123; samesite=none; secure"; // 모든 사이트 (secure 필수)
    ```

- 실제 사용 예시
    1. 로그인 토큰 (= 증명 티켓)
        ```js
        // 로그인 토큰 저장 (7일간 유효, HTTPS only, 모든 경로)
        document.cookie = "authToken=eyJhbCd...; path=/; max-age=604800; secure; samesite=strict";

        // 토큰이 없다면 ... 매 요청마다 로그인해야 함
        fetch('/api/profile')  // "누구세요? 로그인하세요"
        fetch('/api/posts')    // "누구세요? 로그인하세요"

        // 토큰이 있다면 한 번 로그인해도 계속 인증 상태 유지
        fetch('/api/profile')  // 쿠키 자동 전송

        // 또는 명시적으로 credentials 옵션으로 설정 가능 (기본값이라 생략 가능)
        // credentials "include"로 설정시 cookies랑 HTTP-Authorization을 header에 늘 포함시킨다
        fetch('/api/profile', {
            credentials: 'include' // 같은 도메인이면 'same-origin'이 기본값 : cross-origin 요청시 cookies랑 HTTP-Authorization을 header에 포함시키지 않는다.
        })
        ```

    2. 언어 설정 저장 (1년간 유효)
        ```js
        document.cookie = "language=ko; path=/; max-age:31536000";
        ```

    3. 임시 세션 쿠키 (브라우저 닫으면 삭제)
        ```js
        document.cookie = "sessionId=temp123; path=/";
        ```

    4. 쿠키 삭제 (max-age=0 또는 과거 날짜)
        ```js
        document.cookie = "token=; path=/; max-age=0";
        ```
