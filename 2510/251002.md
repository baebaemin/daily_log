## Today I Learned

### [Figma Plugin] 피그마 플러그인 개발 및 등록 과정

- 피그마 플러그인은 UI Process와 Main Process로 분리된 구조를 가지고 있다.

```js
my-plugin/
├── manifest.json // 플러그인의 전체 구성 정보
├── code.js // main.js 등 - Main Process
└── ui.html // UI Process
```

- [개발모드 플러그인 테스트] 파일을 위와 같은 구조로 작성 후 피그마 데스크톱 앱에서 `Plugins` -> `Development` -> `Import plugin from menifest...` 메뉴를 선택해 manifest.json 파일을 Import한다.

#### 1. manifest.json

```json
// 플러그인의 id, 요약 정보
{
  "name": "My Plugin",
  "id": "10249837",
  "api": "1.0.0",
  "main": "code.js", // <- QuickJS에서 실행됨
  "ui": "ui.html" // <- iframe에 표시됨
}
```

#### 2. code.js

```js
// 피그마가 제공하는 환경인 QuickJS 샌드박스에서 실행
figma.showUI(__html__, { width: 400, height: 300 });

figma.ui.onmessage = (msg) => {
  if (msg.type === "my-custom-action") {
    const rect = figma.createRectangle();
    rect.resize(100, 100);
  }
};
```

- 피그마 노드에 접근하여 생성/수정/삭제 가능
- code.js에 작성할 figma plugin API는 이곳을 참고 : https://developers.figma.com/docs/plugins/api/api-reference/
- alert(), fetch(), localStorage, document, window 등 브라우저 API 사용 불가

#### 3. ui.html

```html
<!-- ui.html -->
<!-- iframe에 렌더링 -->
<button id="btn">사각형 만들기</button>
<script>
  document.getElementById("btn").onClick = () => {
    parent.postMessage(
      {
        pluginMessage: { type: "my-custom-action" },
      },
      "*"
    ); // 메세지로 통신 (pluginMessage라는 키 이름은 figma convention)
  };
</script>
```

- 플러그인의 버튼, 입력창, 디자인 UI 작성
- 브라우저 API 전부 사용 가능
- 피그마 파일 직접 조작 (figma.createRectangle() 등) 불가
  - 따라서 [postMessage](https://developers.figma.com/docs/plugins/api/properties/figma-ui-postmessage/) 등 Message Passing 방식으로 진행

#### 퍼블리싱

- `외부에 퍼블리싱` : 피그마 내부에서 직접 퍼블리싱 하면 피그마 서버에 코드가 업로드되며, 다른 사람들이 Community에서 검색해서 설치할 수 있다. 파일을 따로 어딘가에 올릴 필요 X

- `팀 내부용 Private` : Organization 설정에서 Private으로 퍼블리시. 같은 팀 멤버들만 접근 가능하다

- 퍼블리싱 이후에는 [로컬 컴퓨터 -> 피그마 서버에 업로드 -> 사용자가 설치 -> 피그마 앱이 서버에서 다운로드 -> 실행(QuickJS에서 code.js 실행)]의 과정을 거쳐 사용할 수 있게 됨

- Chrome 확장 프로그램을 Chrome Web Store에 올리는 것과 비슷..
