### [Next.js] Next.js 환경변수 접근 방식

- `NEXT_PUBLIC_` 접두사가 있는 경우 클라이언트에서 접근 가능. 즉, 브라우저에서 실행되는 JS 코드에서도 이 환경변수 값을 읽을 수 있음

  - 도메인, 서비스명, 이미지 URL 등 브라우저에서도 필요한 설정값 저장

  ```js
  //.env.production
  NEXT_PUBLIC_SERVICE = hiring;
  ```

  ```ts
  // 브라우저에서 실행되는 코드
  console.log(process.env.NEXT_PUBLIC_SERVICE);

  // React 컴포넌트에서도 사용 가능
  function Header() {
    return <div>현재 서비스: {process.env.NEXT_PUBLIC_SERVICE}</div>;
  }
  ```

- `NEXT_PUBLIC_` 접두사가 없는 경우 서버에서만 접근 가능

  - 브라우저에 노출되면 위험한 DB 비밀번호, api 키 등 민감한 정보를 서버에서만 안전하게 사용

  ```js
  //.env.production
  DATABASE_URL = "postgresql://...";
  API_SECRET_KEY = "secret123";
  ```

  ```ts
  // 클라이언트 사이드에서 접근 불가
  console.log(process.env.DATABASE_URL); // undefined

  // 서버 사이드에서만 접근 가능
  // ex1) Server Component
  export default async function UserPage() {
    const dbUrl = process.env.DATABASE_URL;
    const users = await fetchUsers(dbUrl);

    return (
      <div>
        {users.map((user) => (
          <div key={user.id}>user.name</div>
        ))}
      </div>
    );
  }
  ```

  ```ts
  // ex2) API Route
  export async function GET() {
    const dbUrl = process.env.DATABASE_URL;
    const users = await fetchUsers(dbUrl);

    return Response.json({ users });
  }
  ```

  ```ts
  // ex3) middleware.ts
  import { NextResponse } from "next/server";

  export function middleware(request: Request) {
    const jwtSecret = process.env.JWT_SECRET;
    // 인증 로직 ...
    const token = request.headers.get("authrization");

    if (!isValidToken(token, jwtSecret)) {
      return NextResponse.redirect(new URL("/login", request.url));
    }

    return NextResponse.next();
  }
  ```
