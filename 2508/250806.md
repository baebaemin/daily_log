## Today I Learned

### [TIL-WORDS]

- OOM : Out Of Memory

## <br />

### [React Query] Query Key Factory와 useQuery의 역할 분리

- 상황 : '어학시험 리스트' 정보가 담긴 api를 사용중. 별도의 request option이 없기 때문에 쿼리 키도 고정되어있다. 한 번만 받아서 데이터가 stale되지 않도록 관리하고, 캐싱된 데이터를 가져다 쓰고자 했다.

  ```tsx
  // Query-Key Factory
  export default createQueryKeys("applicants", {
    languageExam: () => ({
      queryKey: ["language-exam"],
      queryFn: () => getLanguageExam(),
      staleTime: Infinity, // error
      gcTime: Infinity, // error
    }),
  });
  ```

- 문제 : staleTime, gcTime을 쿼리 키 팩토리에 옵션을 추가했더니 유효하지 않은 프로퍼티였음

  ```markdown
  > Type 'number' is not assignable to type 'never'.ts(2322)

  > applicants.ts(237, 5): The expected type comes from property 'staleTime' which is declared here on type '{ queryKey: [string]; queryFn: () => Promise<any>; staleTime: never; gcTime: never; }'
  ```

- 해결 : 쿼리 키 팩토리는 보통 쿼리 설정 정보만 반환하고, React Query 옵션들은 사용하는 곳에서 설정해야한다.

  ```tsx
  /**
   * 어학시험 리스트
   * @request GET:/api/applicants/language-exam
   */
  export const useLanguageExam = () => {
    return useQuery<CommonApiResult<LanguageExam[]>>({
      ...queries.applicants.lnguageExam(),
      staleTime: Infinity,
      gcTime: Infinity,
    });
  };
  ```
