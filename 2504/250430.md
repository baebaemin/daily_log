## Today I Learned

### [React] 무조건적인 `"use client"`를 지양해야 하는 이유

경계(boundary)를 만드는 `"use client"`는 선언된 파일과 그 아래의 모든 import된 컴포넌트를 클라이언트 번들에 포함시키게 된다. 그러나 만약 무분별하게 사용한다면 ..

#### 1. 서버 컴포넌트의 이점이 사라짐

- 서버 컴포넌트는 클라이언트로 JS 번들을 전송하지 않는다는 성능상 이점이 있다. => 불필요하게 `"use client"`를 선언하면 서버에서 렌더링될 수 있는 컴포넌트가 클라이언트에서 렌더링되어 번들 크기가 커지고 초기 로딩 속도가 느려진다

#### 2. 데이터 흐름의 최적화가 제한됨

- 서버 컴포넌트는 서버의 데이터에 직접 접근할 수 있어 추가 API 호출이 필요 없다. `"use client"`를 사용하면 이런 직접 접근이 불가능해져 데이터 페칭을 위한 추가 코드가 필요하다.

#### 3. 중첩된 컴포넌트 구조에서 비효율적임

- 하나의 상위 컴포넌트가 `"use client"`를 사용하면, 그 하위의 모든 컴포넌트들도 클라이언트에서 실행된다. 따라서 클라이언트 기능이 필요한 경우, 해당 기능을 사용하는 최하위 컴포넌트에만 `"use client"`를 적용하는 것이 효율적이다. (= 서버단과 클라이언트단 사이의 boundary를 긋기)

#### 4. 하이드레이션 비용이 증가함

- 클라이언트 컴포넌트는 브라우저에서 하이드레이션 과정을 거쳐야 한다. 불필요한 `"use client"` 선언은 하이드레이션해야 할 컴포넌트 수를 증가시켜 첫 페이지 인터랙션 가능 시간(TTI)을 지연시킨다. (= 클라이언트단 범위가 적으면 적을수록 하이드레이션할 컴포넌트 범위가 좁음)

#### 5. 서버-클라이언트 경계가 복잡해짐

- 모든 컴포넌트에 `"use client"`를 사용하면 컴포넌트 간 데이터 전달 시 직렬화 문제가 발생할 가능성이 높아진다. [(관련 warning)](/2504/250417.md#nextjs-props-must-be-serializable-for-components-in-the-use-client-entry-file)

```hs
CASE 1

  [AS-IS]

서버 컴포넌트
ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 있음)
ㄴ ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 있음)
ㄴ ㄴ ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 있음)

  [TO-BE]

서버 컴포넌트
ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 있음)
<!-- 하위의 모든 컴포넌트들은 자동으로 클라이언트 컴포넌트로 취급 -->
ㄴ ㄴ 컴포넌트 (클라이언트 로직 있음)
ㄴ ㄴ ㄴ 컴포넌트 (클라이언트 로직 있음)
```

```hs
CASE 2

  [AS-IS]

서버 컴포넌트
ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 없음)
ㄴ ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 없음)
ㄴ ㄴ ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 있음)

  [TO-BE]

서버 컴포넌트
ㄴ 컴포넌트 (클라이언트 로직 없음)
ㄴ ㄴ 컴포넌트 (클라이언트 로직 없음)
<!-- 클라이언트 로직이 없는 컴포넌트들까지 서버에서 렌더링됨 -->
ㄴ ㄴ ㄴ “use client” 선언 컴포넌트 (클라이언트 로직 있음)
```

#### 👉 언제 선언하는 것이 좋을까?

1. 브라우저 API(window, document 등)에 접근해야 하는 경우
2. 상태(useState, useReducer 등)나 이펙트(useEffect 등)를 사용해야 하는 경우
3. 이벤트 핸들러가 필요한 경우
4. 클라이언트 전용 라이브러리를 사용해야 하는 경우
